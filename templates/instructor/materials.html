{% extends "instructor_base.html" %}
{% block title %}Materials — {{ course.code }}{% endblock %}

{% block content %}
<div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Course Materials</h1>
    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">{{ course.code }} — {{ course.name }}</p>
</div>

{% if error %}
<div class="mb-6 p-4 rounded-xl border bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800">
    <p class="text-sm font-semibold text-red-800 dark:text-red-400">{{ error }}</p>
</div>
{% endif %}

{% if success %}
<div class="mb-6 p-4 rounded-xl border bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-800">
    <p class="text-sm font-semibold text-emerald-800 dark:text-emerald-400">{{ success }}</p>
</div>
{% endif %}

<!-- Existing materials -->
<div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden mb-8">
    <div class="px-5 py-4 border-b border-gray-200 dark:border-gray-700">
        <h2 class="text-base font-semibold text-gray-900 dark:text-white">Materials <span class="text-gray-400 font-normal">({{ materials|length }})</span></h2>
    </div>

    {% if materials %}
    <div class="divide-y divide-gray-100 dark:divide-gray-700">
        {% for m in materials %}
        <div class="px-5 py-4 flex items-start justify-between gap-4">
            <div class="min-w-0 flex-1">
                <div class="flex items-center gap-2 mb-1">
                    <span class="font-medium text-gray-900 dark:text-white text-sm">{{ m.title }}</span>
                    {% if m.url %}
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400">URL</span>
                    {% endif %}
                    {% if m.file %}
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400">File</span>
                    {% endif %}
                </div>
                {% if m.description %}
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">{{ m.description }}</p>
                {% endif %}
                {% if m.url %}
                <a href="{{ m.url }}" target="_blank" rel="noopener" class="text-xs text-brand-600 dark:text-brand-400 hover:underline break-all">{{ m.url }}</a>
                {% endif %}
                {% if m.file %}
                <a href="{{ m.file.url }}" target="_blank" class="text-xs text-brand-600 dark:text-brand-400 hover:underline">{{ m.file.name }}</a>
                {% endif %}
            </div>
            <form method="post" onsubmit="return confirm('Delete this material?')">
                {% csrf_token %}
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="material_id" value="{{ m.pk }}">
                <button type="submit" class="p-1.5 rounded-lg text-gray-400 hover:text-red-600 hover:bg-red-50 dark:hover:text-red-400 dark:hover:bg-red-900/20 transition-colors" title="Delete">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                </button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="px-5 py-8 text-center text-gray-400 dark:text-gray-500">
        <svg class="w-8 h-8 mx-auto mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
        <p>No materials yet. Add one below.</p>
    </div>
    {% endif %}
</div>

<!-- Add material form -->
<div class="max-w-2xl">
    <h2 class="text-base font-semibold text-gray-900 dark:text-white mb-4">Add Material</h2>
    <form method="post" enctype="multipart/form-data"
          class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 space-y-5">
        {% csrf_token %}
        <input type="hidden" name="action" value="add">

        <div>
            <label for="title" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1">Title <span class="text-red-500">*</span></label>
            <input type="text" name="title" id="title" required
                   class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-brand-500 focus:border-brand-500 transition-colors"
                   placeholder="e.g. Week 3 Slides">
        </div>

        <div>
            <label for="description" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1">Description</label>
            <textarea name="description" id="description" rows="2"
                      class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-brand-500 focus:border-brand-500 transition-colors"
                      placeholder="Optional description"></textarea>
        </div>

        <div>
            <label for="url" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1">URL</label>
            <input type="url" name="url" id="url"
                   class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 px-3 py-2 text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-brand-500 focus:border-brand-500 transition-colors"
                   placeholder="https://...">
        </div>

        <div>
            <label for="file" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1">File</label>
            <input type="file" name="file" id="file"
                   class="block w-full text-sm text-gray-500 dark:text-gray-400
                          file:mr-4 file:py-2 file:px-4
                          file:rounded-lg file:border-0
                          file:text-sm file:font-semibold
                          file:bg-brand-50 file:text-brand-700
                          dark:file:bg-brand-700/20 dark:file:text-brand-400
                          hover:file:bg-brand-100 dark:hover:file:bg-brand-700/30
                          file:transition-colors file:cursor-pointer">
            <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">Provide at least one of URL or File.</p>
        </div>

        <div class="flex items-center gap-3">
            <button type="submit"
                    class="inline-flex items-center gap-2 px-5 py-2.5 bg-brand-600 hover:bg-brand-700 text-white text-sm font-medium rounded-lg hover:scale-[1.02] active:scale-[0.98] transition-all duration-200">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
                Add Material
            </button>
            <a href="{% url 'instructor:course_dashboard' course.pk %}"
               class="text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors">
                Back to Dashboard
            </a>
        </div>
    </form>
</div>
{% endblock %}
